---
title: "discussion_presentation_data_exploration"
author: "Chase Brewster"
date: "1/23/2020"
output: html_document
---

This .Rmd holds every combination of expirements we have ran. It has all assessment intervals (0, 20, 15, 10, 5, every year), tested against all errors (.5, .3, .1), and all harvest control rules (.95 - .50), under the constant fmsy scenario.

The resulting dataset - "alldata" - can then be altered independently to create different data explorations and visualizations.

To explore data, follow the steps below:

1. Packages Needed
```{r}
library(tidyverse)
library(here)
```

2. Read in the csv files, add columns for data exploration grouping, and bind all csv's to the main data set, "alldata"

```{r}
low_err <- read_csv(file=file.path(here(),"/Presentation/discussion/decisiontable_lowerr.csv"))
mid_err <- read_csv(file=file.path(here(),"/Presentation/discussion/decisiontable_miderr.csv"))
high_err <- read_csv(file=file.path(here(),"/Presentation/discussion/decisiontable_higherr.csv"))

low_err_10 <- read_csv(file=file.path(here(),"/Presentation/discussion/decisiontable_lowerr_10.csv"))
mid_err_10 <- read_csv(file=file.path(here(),"/Presentation/discussion/decisiontable_miderr_10.csv"))
high_err_10 <- read_csv(file=file.path(here(),"/Presentation/discussion/decisiontable_higherr_10.csv"))

low_err_15 <- read_csv(file=file.path(here(),"/Presentation/discussion/decisiontable_lowerr_15.csv"))
mid_err_15 <- read_csv(file=file.path(here(),"/Presentation/discussion/decisiontable_miderr_15.csv"))
high_err_15 <- read_csv(file=file.path(here(),"/Presentation/discussion/decisiontable_higherr_15.csv"))

low_err_20 <- read_csv(file=file.path(here(),"/Presentation/discussion/decisiontable_lowerr_20.csv"))
mid_err_20 <- read_csv(file=file.path(here(),"/Presentation/discussion/decisiontable_miderr_20.csv"))
high_err_20 <- read_csv(file=file.path(here(),"/Presentation/discussion/decisiontable_higherr_20.csv"))

low_err_0 <- read_csv(file=file.path(here(),"/Presentation/discussion/decisiontable_lowerr_0.csv"))
mid_err_0 <- read_csv(file=file.path(here(),"/Presentation/discussion/decisiontable_miderr_0.csv"))
high_err_0 <- read_csv(file=file.path(here(),"/Presentation/discussion/decisiontable_higherr_0.csv"))

low_err_all <- read_csv(file=file.path(here(),"/Presentation/discussion/decisiontable_lowerr_all.csv"))
mid_err_all <- read_csv(file=file.path(here(),"/Presentation/discussion/decisiontable_miderr_all.csv"))
high_err_all <- read_csv(file=file.path(here(),"/Presentation/discussion/decisiontable_higherr_all.csv"))

low_err_1 <- low_err %>% 
  filter(year == 100) %>% 
  mutate(status = ifelse(f_ratio == 0, "closed", ifelse(b <= 1000, "over", "good"))) %>% 
  mutate(growth = ifelse(r_0 <= .3, "slow", ifelse(r_0 > .3 & r_0 <= .5, "medium", "fast"))) %>% 
  mutate(assess = "5")

mid_err_1 <- mid_err %>% 
  filter(year == 100) %>% 
  mutate(status = ifelse(f_ratio == 0, "closed", ifelse(b <= 1000, "over", "good"))) %>% 
  mutate(growth = ifelse(r_0 <= .3, "slow", ifelse(r_0 > .3 & r_0 <= .5, "medium", "fast"))) %>% 
  mutate(assess = "5")

high_err_1 <- high_err %>% 
  filter(year == 100) %>% 
  mutate(status = ifelse(f_ratio == 0, "closed", ifelse(b <= 1000, "over", "good"))) %>% 
  mutate(growth = ifelse(r_0 <= .3, "slow", ifelse(r_0 > .3 & r_0 <= .5, "medium", "fast"))) %>% 
  mutate(assess = "5")
  
low_err_2 <- low_err_10 %>% 
  filter(year == 100) %>% 
  mutate(status = ifelse(f_ratio == 0, "closed", ifelse(b <= 1000, "over", "good"))) %>% 
  mutate(growth = ifelse(r_0 <= .3, "slow", ifelse(r_0 > .3 & r_0 <= .5, "medium", "fast"))) %>% 
  mutate(assess = "10")

mid_err_2 <- mid_err_10 %>% 
  filter(year == 100) %>% 
  mutate(status = ifelse(f_ratio == 0, "closed", ifelse(b <= 1000, "over", "good"))) %>% 
  mutate(growth = ifelse(r_0 <= .3, "slow", ifelse(r_0 > .3 & r_0 <= .5, "medium", "fast"))) %>% 
  mutate(assess = "10")

high_err_2 <- high_err_10 %>% 
  filter(year == 100) %>% 
  mutate(status = ifelse(f_ratio == 0, "closed", ifelse(b <= 1000, "over", "good"))) %>% 
  mutate(growth = ifelse(r_0 <= .3, "slow", ifelse(r_0 > .3 & r_0 <= .5, "medium", "fast"))) %>% 
  mutate(assess = "10")
  
low_err_3 <- low_err_15 %>% 
  filter(year == 100) %>% 
  mutate(status = ifelse(f_ratio == 0, "closed", ifelse(b <= 1000, "over", "good"))) %>% 
  mutate(growth = ifelse(r_0 <= .3, "slow", ifelse(r_0 > .3 & r_0 <= .5, "medium", "fast"))) %>% 
  mutate(assess = "15")

mid_err_3 <- mid_err_15 %>% 
  filter(year == 100) %>% 
  mutate(status = ifelse(f_ratio == 0, "closed", ifelse(b <= 1000, "over", "good"))) %>% 
  mutate(growth = ifelse(r_0 <= .3, "slow", ifelse(r_0 > .3 & r_0 <= .5, "medium", "fast"))) %>% 
  mutate(assess = "15")

high_err_3 <- high_err_15 %>% 
  filter(year == 100) %>% 
  mutate(status = ifelse(f_ratio == 0, "closed", ifelse(b <= 1000, "over", "good"))) %>% 
  mutate(growth = ifelse(r_0 <= .3, "slow", ifelse(r_0 > .3 & r_0 <= .5, "medium", "fast"))) %>% 
  mutate(assess = "15")

low_err_4 <- low_err_20 %>% 
  filter(year == 100) %>% 
  mutate(status = ifelse(f_ratio == 0, "closed", ifelse(b <= 1000, "over", "good"))) %>% 
  mutate(growth = ifelse(r_0 <= .3, "slow", ifelse(r_0 > .3 & r_0 <= .5, "medium", "fast"))) %>% 
  mutate(assess = "20")

mid_err_4 <- mid_err_20 %>% 
  filter(year == 100) %>% 
  mutate(status = ifelse(f_ratio == 0, "closed", ifelse(b <= 1000, "over", "good"))) %>% 
  mutate(growth = ifelse(r_0 <= .3, "slow", ifelse(r_0 > .3 & r_0 <= .5, "medium", "fast"))) %>% 
  mutate(assess = "20")

high_err_4 <- high_err_20 %>% 
  filter(year == 100) %>% 
  mutate(status = ifelse(f_ratio == 0, "closed", ifelse(b <= 1000, "over", "good"))) %>% 
  mutate(growth = ifelse(r_0 <= .3, "slow", ifelse(r_0 > .3 & r_0 <= .5, "medium", "fast"))) %>% 
  mutate(assess = "20")

low_err_5 <- low_err_0 %>% 
  filter(year == 100) %>% 
  mutate(status = ifelse(f_ratio == 0, "closed", ifelse(b <= 1000, "over", "good"))) %>% 
  mutate(growth = ifelse(r_0 <= .3, "slow", ifelse(r_0 > .3 & r_0 <= .5, "medium", "fast"))) %>% 
  mutate(assess = "0")

mid_err_5 <- mid_err_0 %>% 
  filter(year == 100) %>% 
  mutate(status = ifelse(f_ratio == 0, "closed", ifelse(b <= 1000, "over", "good"))) %>% 
  mutate(growth = ifelse(r_0 <= .3, "slow", ifelse(r_0 > .3 & r_0 <= .5, "medium", "fast"))) %>% 
  mutate(assess = "0")

high_err_5 <- high_err_0 %>% 
  filter(year == 100) %>% 
  mutate(status = ifelse(f_ratio == 0, "closed", ifelse(b <= 1000, "over", "good"))) %>% 
  mutate(growth = ifelse(r_0 <= .3, "slow", ifelse(r_0 > .3 & r_0 <= .5, "medium", "fast"))) %>% 
  mutate(assess = "0")

low_err_6 <- low_err_all %>% 
  filter(year == 100) %>% 
  mutate(status = ifelse(f_ratio == 0, "closed", ifelse(b <= 1000, "over", "good"))) %>% 
  mutate(growth = ifelse(r_0 <= .3, "slow", ifelse(r_0 > .3 & r_0 <= .5, "medium", "fast"))) %>% 
  mutate(assess = "all")

mid_err_6 <- mid_err_all %>% 
  filter(year == 100) %>% 
  mutate(status = ifelse(f_ratio == 0, "closed", ifelse(b <= 1000, "over", "good"))) %>% 
  mutate(growth = ifelse(r_0 <= .3, "slow", ifelse(r_0 > .3 & r_0 <= .5, "medium", "fast"))) %>% 
  mutate(assess = "all")

high_err_6 <- high_err_all %>% 
  filter(year == 100) %>% 
  mutate(status = ifelse(f_ratio == 0, "closed", ifelse(b <= 1000, "over", "good"))) %>% 
  mutate(growth = ifelse(r_0 <= .3, "slow", ifelse(r_0 > .3 & r_0 <= .5, "medium", "fast"))) %>% 
  mutate(assess = "all")


alldata <- rbind(low_err_1, mid_err_1, high_err_1, low_err_2, mid_err_2, high_err_2, low_err_3, mid_err_3, high_err_3, low_err_4, mid_err_4, high_err_4, low_err_5, mid_err_5, high_err_5, low_err_6, mid_err_6, high_err_6)

```

3. From here, use the "alldata" dataset to explore different combinations. Always create a new dataframe for the specific exploration when using "alldata" to avoid writing over the main dataset.

We will have to recategorize some variables as factors to properly group and graph.


Assessment Intervals & Error
```{r}

assess_error <- alldata %>% 
  group_by(error, growth, assess) %>%
  filter(r_s <= 0) %>%
  filter(r_s >= -0.00767) %>% 
  filter(b_0 == 1500) %>%
  count(status) %>% 
  spread(key = "status", value = "n") %>% 
  mutate_if(is.numeric, ~replace(., is.na(.), 0)) %>% 
  mutate(prop_bad = (closed + over)/(good + over + closed)) %>% 
  mutate(prop_closed = (closed)/(good + over + closed))
  

assess_error$error <- as.factor(assess_error$error)
assess_error$assess <- as.factor(assess_error$assess)

assess_error_graph <- ggplot(assess_error, aes(x = assess, y = prop_bad, fill = error))  + 
  geom_col(position = "dodge")

assess_error_graph
```

Error & Harvest Control Rules
```{r}

hcr_error <- alldata %>% 
  group_by(error, growth, hcr) %>%
  filter(r_s <= 0) %>%
  filter(r_s >= -0.00767) %>% 
  filter(hcr == 0.9 | hcr == 0.8 | hcr == 0.7 | hcr == 0.6 | hcr == 0.5) %>%
  count(status) %>% 
  spread(key = "status", value = "n") %>% 
  mutate_if(is.numeric, ~replace(., is.na(.), 0)) %>% 
  mutate(prop_bad = (closed + over)/(good + over + closed)) %>% 
  mutate(prop_closed = (closed)/(good + over + closed))
  

hcr_error$error <- as.factor(hcr_error$error)

hcr_error_graph <- ggplot(hcr_error, aes(x = hcr, y = prop_bad, fill = error))  + 
  geom_col(position = "dodge") +
  scale_x_reverse()

hcr_error_graph
```

Harvest Control Rules & Assessment Intervals
```{r}

hcr_assess <- alldata %>% 
  group_by(assess, growth, hcr) %>%
  filter(r_s <= 0) %>%
  filter(r_s >= -0.00767) %>% 
  filter(hcr == 0.9 | hcr == 0.8 | hcr == 0.7 | hcr == 0.6 | hcr == 0.5) %>%
  filter(error == 0.3 | error == 0.1) %>% 
  count(status) %>% 
  spread(key = "status", value = "n") %>% 
  mutate_if(is.numeric, ~replace(., is.na(.), 0)) %>% 
  mutate(prop_bad = (closed + over)/(good + over + closed)) %>% 
  mutate(prop_closed = (closed)/(good + over + closed)) %>% 
  mutate(prop_over = (over)/(good + over))
  

hcr_assess$assess<- as.factor(hcr_assess$assess)
hcr_assess$hcr <- as.factor(hcr_assess$hcr)

hcr_assess_graph <- ggplot(hcr_assess, aes(x = assess, y = prop_bad, fill = hcr))  + 
  geom_col(position = "dodge")

hcr_assess_graph
```

