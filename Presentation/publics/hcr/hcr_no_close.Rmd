---
title: "hcr_no_close"
author: "Sara Orofino"
date: "4/7/2020"
output: html_document
---

I want to replicate the graphs used in faculty reviews for HCRs but instead use the new combined data where instead of closing the fishery if it is over the limit, catch is reduced by 95%.  

## Packages/Data 

```{r packages-data, warning=FALSE, message=FALSE}
library(tidyverse)
library(here)

hcr_c <- read_csv(file=file.path(here(), "/analysis/no_closure/all_data/noclose_all_c.csv"))
```


## Wrangle
```{r wrangle}
##Wrangling with the combined data set:
hcr_c[is.na(hcr_c)] <- "misc" #turn status NA into misc

# Calculate proportions for graphing:
hcr_props_c <- hcr_c %>% 
  group_by(hcr) %>%
  count(status) %>% 
  spread(key = "status", value = "n") %>% 
  mutate(simulations = sum(over + good + misc)) %>% 
  mutate(prop_good = good / simulations)
```

## Graph Constant FMSY:
```{r graph-constant}
hcr_c <- ggplot(hcr_props_c, aes(x = hcr, y = prop_good)) +
  geom_col(alpha = 0.7, fill = "#079EDF") + 
  theme_light()+
  coord_cartesian( ylim=c(0,1), expand = FALSE ) +
  scale_x_reverse(labels=c("0.5" = "50%","0.6" = "40%" ,"0.7" = "30%","0.8" = "20%","0.9" = "10%","1.0" = "0%")) +
  labs(title = "Fishing Reduction Response", x = "Reduction Amount (%)", y = "Proportion Healthy")+
  theme(axis.text.x=element_text(size=15), axis.text.y=element_text(size=15), plot.title = element_text(hjust = 0.5, face = "bold", size = 20), axis.title.x = element_text(face = "bold", size = 15), axis.title.y = element_text(face = "bold", size = 15), legend.title.align=0.5, panel.background = element_rect(fill = "transparent",colour = NA), plot.background = element_rect(fill = "transparent",colour = NA), legend.title=element_text(size=15), 
    legend.text=element_text(size=12),legend.key = element_rect(fill = "transparent", colour = "transparent"), legend.background = element_blank(),
    legend.box.background = element_blank()) 

hcr_c

# ggsave(hcr_c, filename = "hcr_c_noclose.png",  bg = "transparent",
#       width = 6, height = 4)
```

## New Updating Data (no closure)  

```{r read-updating, warning=FALSE, message=FALSE}
hcr_u <- read_csv(file=file.path(here(), "/analysis/no_closure/all_data/noclose_all_u.csv"))
```

## Wrangle Updating
```{r wrangle}
##Wrangling with the combined data set:
hcr_u[is.na(hcr_u)] <- "misc" #turn status NA into misc

# Calculate proportions for graphing:
hcr_props_u <- hcr_u %>% 
  group_by(hcr) %>%
  count(status) %>% 
  spread(key = "status", value = "n") %>% 
  mutate(simulations = sum(over + good + misc)) %>% 
  mutate(prop_good = good / simulations)
```

## Create Graphing Data - both

```{r wrangle-graph-data, include=FALSE}

##Create the all graph data frame - start with constant and add updating then merge:
graph_c <- data.frame(hcr = hcr_props_c$hcr, productivity = rep("constant", 10),
                      prop_good = hcr_props_c$prop_good)
graph_u <- data.frame(hcr = hcr_props_u$hcr, productivity = rep("updating", 10),
                      prop_good = hcr_props_u$prop_good)
graph_both <- rbind(graph_c, graph_u)

```


## Graph Constant vs. Updating
```{r graph-both}
hcr_both <- ggplot(graph_both, aes(x = hcr, y = prop_good, fill = productivity)) +
  geom_col(position = "dodge", alpha = 0.7) + 
  scale_fill_manual(values = c("#079EDF", "#BC6435"), name = "Climate Response", labels = c("None", "Perfect"))+
  theme_light()+
  coord_cartesian( ylim=c(0,1), expand = FALSE ) +
  scale_x_reverse(labels=c("0.5" = "50%","0.6" = "40%" ,"0.7" = "30%","0.8" = "20%","0.9" = "10%","1.0" = "0%")) +
  labs(title = "Fishing Reduction Response", x = "Reduction Amount (%)", y = "Proportion Healthy")+
  theme(axis.text.x=element_text(size=15), axis.text.y=element_text(size=15), plot.title = element_text(hjust = 0.5, face = "bold", size = 20), axis.title.x = element_text(face = "bold", size = 15), axis.title.y = element_text(face = "bold", size = 15), legend.title.align=0.5, panel.background = element_rect(fill = "transparent",colour = NA), plot.background = element_rect(fill = "transparent",colour = NA), legend.title=element_text(size=15), 
    legend.text=element_text(size=12),legend.key = element_rect(fill = "transparent", colour = "transparent"), legend.background = element_blank(),
    legend.box.background = element_blank()) 

hcr_both

# ggsave(hcr_both, filename = "hcr_both_noclose.png",  bg = "transparent",
#       width = 6, height = 4)
```
