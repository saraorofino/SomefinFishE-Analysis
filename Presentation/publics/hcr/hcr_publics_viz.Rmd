---
title: "hcr_publics_viz"
author: "Sara Orofino"
date: "4/7/2020"
output: html_document
---

I'm creating three graphs for the public presentation:

 - Graph 1: Just the individual test result with constant productivity using the proportion of healthy fisheries as y axis
 - Graph 2: Compare the results of prop healthy for constant vs. updating productivity (but I'll change the labels)  
 - Graph 3: Compare prop healthy for constant, updating, and proxy results  

## Packages

```{r packages-data, warning=FALSE, message=FALSE}
library(tidyverse)
library(here)
```

## Data Constant Fmsy:
```{r data-c, warning=FALSE, message=FALSE}
hcr_c <- read_csv(file = file.path(here(), "/Presentation/discussion/alldata_combined.csv"))
```


## Wrangle Constant: 
```{r wrangle}
##Wrangling with the combined data set:
hcr_c[is.na(hcr_c)] <- "misc" #turn status NA into misc

# Calculate proportions for graphing:
hcr_props_c <- hcr_c %>% 
  filter(error != 0.5) %>% 
  group_by(hcr) %>%
  count(status) %>% 
  spread(key = "status", value = "n") %>% 
  mutate(simulations = sum(closed + over + good + misc)) %>% 
  mutate(prop_good = good / simulations)
```

## Graph 1: Constant FMSY:
```{r graph-constant}
hcr_c_graph <- ggplot(hcr_props_c, aes(x = hcr, y = prop_good)) +
  geom_col(alpha = 0.8, fill = "#BC6435") + 
  theme_light()+
  coord_cartesian( ylim=c(0,1), expand = FALSE ) +
  scale_x_reverse(labels=c("0.5" = "50%","0.6" = "40%" ,"0.7" = "30%","0.8" = "20%","0.9" = "10%","1.0" = "0%")) +
  labs(title = "Fishing Reduction", x = "Reduction Amount (%)", y = "Proportion Healthy")+
  theme(axis.text.x=element_text(size=15), axis.text.y=element_text(size=15), plot.title = element_text(hjust = 0.5, face = "bold", size = 20), axis.title.x = element_text(face = "bold", size = 15), axis.title.y = element_text(face = "bold", size = 15), legend.title.align=0.5, panel.background = element_rect(fill = "transparent",colour = NA), plot.background = element_rect(fill = "transparent",colour = NA), legend.title=element_text(size=15), 
    legend.text=element_text(size=12),legend.key = element_rect(fill = "transparent", colour = "transparent"), legend.background = element_blank(),
    legend.box.background = element_blank()) 

hcr_c_graph

# ggsave(hcr_c_graph, filename = "hcr_c.png",  bg = "transparent",
#       width = 6, height = 4)
```

## Updating Data 

```{r read-updating, warning=FALSE, message=FALSE}
hcr_u <- read_csv(file=file.path(here(), "/Analysis/fmsy_analysis/fmsy_u_all.csv"))
```

## Wrangle Updating
```{r wrangle-u}
hcr_u[is.na(hcr_u)] <- "misc" #change status=Na to misc

## Combine and calculate proportions:
hcr_props_u_all <- hcr_u %>% 
  filter(error != 0.5) %>% 
  group_by(hcr) %>%
  count(status) %>% 
  spread(key = "status", value = "n") %>% 
  mutate_if(is.numeric, ~replace(., is.na(.), 0)) %>% 
  mutate(simulations = sum(closed + over + good + misc)) %>% 
  mutate(prop_good = good / simulations)
```

## Create Graphing Data - both

```{r wrangle-graph-data, include=FALSE}

##Create the all graph data frame - start with constant and add updating then merge:
graph_c <- data.frame(hcr = hcr_props_c$hcr, response = rep("none", 10),
                      prop_good = hcr_props_c$prop_good)
graph_u <- data.frame(hcr = hcr_props_u_all$hcr, response = rep("ideal", 10),
                      prop_good = hcr_props_u_all$prop_good)
graph_both <- rbind(graph_c, graph_u)

```


## Graph 2: Constant vs. Updating
```{r graph-both}
hcr_both <- ggplot(graph_both, aes(x = hcr, y = prop_good, fill = response)) +
  geom_col(position = "dodge", alpha = 0.8) + 
  scale_fill_manual(values = c("#BC6435", "#079EDF"), name = "Climate Response", labels = c("None", "Ideal")) +
  theme_light()+
  coord_cartesian( ylim=c(0,1), expand = FALSE ) +
  scale_x_reverse(labels=c("0.5" = "50%","0.6" = "40%" ,"0.7" = "30%","0.8" = "20%","0.9" = "10%","1.0" = "0%")) +
  labs(title = "Fishing Reduction", x = "Reduction Amount (%)", y = "Proportion Healthy")+
  theme(axis.text.x=element_text(size=15), axis.text.y=element_text(size=15), plot.title = element_text(hjust = 0.5, face = "bold", size = 20), axis.title.x = element_text(face = "bold", size = 15), axis.title.y = element_text(face = "bold", size = 15), legend.title.align=0.5, panel.background = element_rect(fill = "transparent",colour = NA), plot.background = element_rect(fill = "transparent",colour = NA), legend.title=element_text(size=15), 
    legend.text=element_text(size=12),legend.key = element_rect(fill = "transparent", colour = "transparent"), legend.background = element_blank(),
    legend.box.background = element_blank()) 

hcr_both

# ggsave(hcr_both, filename = "hcr_ideal.png",  bg = "transparent",
#       width = 6, height = 4)
```


## Proxy Data:
```{r proxy-data, warning=FALSE, message=FALSE}
hcr_p <- read_csv(file=file.path(here(),"/Results/productivity_proxy/for_publics/old_model/proxy_old_all_publics.csv"))
```
NOTE: this data is missing the 0.95 hcr  

## Wrangle Proxy:
Note, I filtered out error = 0.5 for the two graphs above. 
```{r wrangle-proxy}
hcr_p[is.na(hcr_p)] <- "misc" #change status=Na to misc 

## Combine and calculate proportions:
hcr_props_p <- hcr_p %>% 
  filter(error != 0.5) %>% 
  filter(ai != 0) %>% #filter out no repeat (none of the other data has this ai)
  group_by(hcr) %>%
  count(status) %>% 
  spread(key = "status", value = "n") %>% 
  mutate_if(is.numeric, ~replace(., is.na(.), 0)) %>% 
  mutate(simulations = sum(closed + over + good + misc)) %>% 
  mutate(prop_good = good / simulations)
```


## Graphing Data: 
```{r graph3-data}
##Create the all graph data frame - start with constant and add updating then merge:
graph_c <- data.frame(hcr = hcr_props_c$hcr, response = rep("none", 10),
                      prop_good = hcr_props_c$prop_good)
graph_u <- data.frame(hcr = hcr_props_u_all$hcr, response = rep("ideal", 10),
                      prop_good = hcr_props_u_all$prop_good)
graph_pre <- data.frame(hcr = hcr_props_p$hcr, response = rep("precautionary", 9),
                        prop_good = hcr_props_p$prop_good) 
graph_all <- rbind(graph_c, graph_u, graph_pre)
```


## Graph 3 - Constant vs. Updating vs. Proxy  
Colors:  
 - For the original no climate response use: "#BC6435"  
 - For the ideal climate response use:  "#079EDF"   
 - For proxy results (precautionary) try: "#B8CE55" (but this might not look great - we aren't sure) 

```{r graph3-all}
hcr_all <- ggplot(graph_all, aes(x = hcr, y = prop_good, fill = response)) +
  geom_col(position = "dodge", alpha = 0.8) + 
  scale_fill_manual(values = c("#BC6435", "#079EDF", "#B8CE55"), name = "Climate Response", labels = c("None", "Ideal", "Precautionary")) +
  theme_light()+
  coord_cartesian( ylim=c(0,1), expand = FALSE ) +
  scale_x_reverse(labels=c("0.5" = "50%","0.6" = "40%" ,"0.7" = "30%","0.8" = "20%","0.9" = "10%","1.0" = "0%")) +
  labs(title = "Fishing Reduction", x = "Reduction Amount (%)", y = "Proportion Healthy")+
  theme(axis.text.x=element_text(size=15), axis.text.y=element_text(size=15), plot.title = element_text(hjust = 0.5, face = "bold", size = 20), axis.title.x = element_text(face = "bold", size = 15), axis.title.y = element_text(face = "bold", size = 15), legend.title.align=0.5, panel.background = element_rect(fill = "transparent",colour = NA), plot.background = element_rect(fill = "transparent",colour = NA), legend.title=element_text(size=15), 
    legend.text=element_text(size=12),legend.key = element_rect(fill = "transparent", colour = "transparent"), legend.background = element_blank(),
    legend.box.background = element_blank()) 

hcr_all
```

